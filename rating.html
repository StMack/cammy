<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="author" content="">

		<title>Give it a CAAMY | Sponsored by AT&T</title>


		<!-- Bootstrap core CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet"> 
		<link href="css/bootstrap-combobox.css" rel="stylesheet"> 
		<link href="css/cammy.css" rel="stylesheet">
	

		<!-- Just for debugging purposes. Don't actually copy this line! -->
		<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
			<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>

	<body> 
		<div class="container">
			<header>
				<div class="row">
					<div class="col-sm-12 text-center caamLogo">
						<a href="http://caamedia.org"><img src="img/caamfest-logo.png"></a>
					</div>
				</div>
			</header>

			<div class="row ratingResult">
				<div class="col-sm-10 col-centered">
					<p>Like It<span class="lovedIt">Love It</span></p>
				      <div class="progress">
				        <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="80" class="progress-bar" role="progressbar"></div>
				      </div>
				      <p class="ratingCopy text-center">Enter your rating by clicking the CAAMYs below (up to 5)</p>
				</div>
			</div>


		<section class="rating">
			<form>
				<div class="row newRating">
						<div class='cammyRating'>
						    <div id="r1" class="rate_widget">
						        <div class="star_1 ratings_stars"></div>
						        <div class="star_2 ratings_stars"></div>
						        <div class="star_3 ratings_stars"></div>
						        <div class="star_4 ratings_stars"></div>
						        <div class="star_5 ratings_stars"></div>
						        <div class="clearfix"></div>
						        <div class="col-sm-3 scale col-xs-6 mainScale">Like It</div> 
						        <div class="col-sm-3 col-xs-4 pull-right scale mainScale love">Love It</div>
						    </div>
						</div>
				</div>

				<div class="row emailForm">
					<div class="col-sm-8 col-centered">
						<input id="textinput" name="textinput" type="text" placeholder="Email" class="form-control input-md">
					</div>
				</div>
				<div class="row emailForm">
					<div class="col-sm-8 col-centered">
						<div class="col-sm-10 col-xs-12 instructions">
							<p>One rating submission per person. Maximum rating votes is based on the number of times a film is shown and seating capacity.</p>
						</div>
						<div class="col-sm-2 col-xs-4 pull-right">
    						<button id="singlebutton" name="singlebutton" class="btn btn-primary">Submit</button>
  						</div>
				</div>
			</form>
		</section>

		<section class="film">
			<div class="row filmInfo">
				<div class="col-sm-6">
					<img src="img/whale.png">
				</div>
				<div class="col-sm-6">
				<p class="filmTitle">The Name of the Whale</p>
				<p class="filmCredits">FUMITO FUJIKAWA / CINEMASIA / JAPAN / 2015 / 91 MINS</p>
				<p class="filmCopy">Junior high student Yuta is assigned the task of excavating fossils as a summer school project. The contentment this assignment brings him is abruptly shattered when pieces of his everyday life begin to fall apart, and Yuta must soon find the balance between his old and new worlds.</p>
				</div>
			</div>
		</section>

		<section class="attAd">
			<div class="row">
				<div class="col-sm-12 text-center bannerAd">
					<a href="https://www.att.com/shop/wireless/unlimited-plan.html"><img src="img/att-unlimited-plans.png"></a>
				</div>
				<div class="col-sm-12 text-center mobileAd">
					<a href="https://www.att.com/shop/wireless/unlimited-plan.html"><img src="img/att-add-mobile.png"></a>
				</div>
			</div>
		</section>

		<footer>
			<div class="row legal">
				<div class="col-sm-12">
					<p><a href="http://clicks.att.com/OCT/eTrac?EMAIL_ID=1012748074&finalURL=http://att.com/Trademark-Copyright-Privacy-Policy?source=EACQM0ftr0000000E">Â© 2016 AT&T Intellectual Property</a>.  All rights reserved. AT&T, Globe logo, Mobilizing Your World and DIRECTV are registered trademarks of AT&T Intellectual Property and/or AT&T affiliated companies. All other marks are the property of their respective owners</p>
				</div>
				<div class="col-sm-3 col-xs-4 pull-right">
					<img src="img/att_globe_rgb_pos.png">
				</div>
			</div>
		</footer>
			

		</div><!-- /container -->

		<!-- Bootstrap core JavaScript
		================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/placeholders.min.js"></script>
		<script src="js/bootstrap-combobox.js"></script>

		<script type="text/javascript">
		  $(document).ready(function(){
		    $('.combobox').combobox();
		  });
		</script>

		<script type="text/javascript">
			var bar = $('.progress-bar');
			$(function(){
  			$(bar).each(function(){
    		bar_width = $(this).attr('aria-valuenow');
    		$(this).width(bar_width + '%');
  			});
			});
		</script>

		 <script type="text/javascript">

		    $(document).ready(function() {
        
	        $('.rate_widget').each(function(i) {
	            var widget = this;
	            var out_data = {
	                widget_id : $(widget).attr('id'),
	                fetch: 1
	            };
            $.post(
                'ratings.php',
                out_data,
                function(INFO) {
                    $(widget).data( 'fsr', INFO );
                    set_votes(widget);
                },
                'json'
	            );
	        });
    

	        $('.ratings_stars').hover(
	            // Handles the mouseover
	            function() {
	                $(this).prevAll().andSelf().addClass('ratings_over');
	                $(this).nextAll().removeClass('ratings_vote'); 
	            },
	            // Handles the mouseout
	            function() {
	                $(this).prevAll().andSelf().removeClass('ratings_over');
	                // can't use 'this' because it wont contain the updated data
	                set_votes($(this).parent());
	            }
	        );
        
        
	        // This actually records the vote
	        $('.ratings_stars').bind('click', function() {
	            var star = this;
	            var widget = $(this).parent();
	            
	            var clicked_data = {
	                clicked_on : $(star).attr('class'),
	                widget_id : $(star).parent().attr('id')
	            };
	            $.post(
	                'ratings.php',
	                clicked_data,
	                function(INFO) {
	                    widget.data( 'fsr', INFO );
	                    set_votes(widget);
	                },
	                'json'
	            ); 
	        });
	    });

	    function set_votes(widget) {

        var avg = $(widget).data('fsr').whole_avg;
        var votes = $(widget).data('fsr').number_votes;
        var exact = $(widget).data('fsr').dec_avg;
    
        window.console && console.log('and now in set_votes, it thinks the fsr is ' + $(widget).data('fsr').number_votes);
        
        $(widget).find('.star_' + avg).prevAll().andSelf().addClass('ratings_vote');
        $(widget).find('.star_' + avg).nextAll().removeClass('ratings_vote'); 
        $(widget).find('.total_votes').text( votes + ' votes recorded (' + exact + ' rating)' );
	    }    
    </script>

</body>
</html>
